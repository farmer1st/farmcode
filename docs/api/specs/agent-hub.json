{
  "openapi": "3.1.0",
  "info": {
    "title": "Agent Hub Service",
    "description": "The Agent Hub Service is the central coordination layer for all agent interactions. It routes requests to agent services, validates confidence, manages sessions, and handles human escalation via GitHub comments.",
    "version": "0.1.0"
  },
  "paths": {
    "/invoke/{agent}": {
      "post": {
        "tags": [
          "invoke"
        ],
        "summary": "Invoke Agent",
        "description": "Invoke a specific agent with a workflow request.\n\nArgs:\n    agent: Agent name (e.g., baron, duc, marie)\n    request: InvokeRequest with workflow_type, context, parameters\n\nReturns:\n    InvokeResponse with result and metadata\n\nRaises:\n    HTTPException: On validation or execution error",
        "operationId": "invoke_agent_invoke__agent__post",
        "parameters": [
          {
            "name": "agent",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Agent"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/InvokeRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/InvokeResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "Agent not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "504": {
            "description": "Agent timeout",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/ask/{topic}": {
      "post": {
        "tags": [
          "ask"
        ],
        "summary": "Ask Expert",
        "description": "Ask expert by topic.\n\nRoutes a question to the appropriate expert agent based on topic.\nValidates confidence and creates escalation if below threshold.\nIf session_id is provided, includes previous conversation context.\n\nArgs:\n    topic: Topic for routing (e.g., architecture, security)\n    request: AskExpertRequest with question and context\n    db: Database session\n\nReturns:\n    AskExpertResponse with answer and confidence\n\nRaises:\n    HTTPException: On validation or execution error",
        "operationId": "ask_expert_ask__topic__post",
        "parameters": [
          {
            "name": "topic",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Topic"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AskExpertRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AskExpertResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "Unknown topic",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/sessions": {
      "post": {
        "tags": [
          "sessions"
        ],
        "summary": "Create Session",
        "description": "Create a new session for multi-turn conversations.\n\nArgs:\n    request: CreateSessionRequest with agent_id and optional feature_id\n    db: Database session\n\nReturns:\n    SessionResponse with created session",
        "operationId": "create_session_sessions_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateSessionRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "201": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SessionResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/sessions/{session_id}": {
      "get": {
        "tags": [
          "sessions"
        ],
        "summary": "Get Session",
        "description": "Get session with message history.\n\nArgs:\n    session_id: Session UUID\n    db: Database session\n\nReturns:\n    SessionWithMessagesResponse with session and messages\n\nRaises:\n    HTTPException: If session not found",
        "operationId": "get_session_sessions__session_id__get",
        "parameters": [
          {
            "name": "session_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Session Id"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SessionWithMessagesResponse"
                }
              }
            }
          },
          "404": {
            "description": "Session not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "sessions"
        ],
        "summary": "Close Session",
        "description": "Close a session, preserving history for audit.\n\nArgs:\n    session_id: Session UUID\n    db: Database session\n\nReturns:\n    SessionResponse with closed session\n\nRaises:\n    HTTPException: If session not found",
        "operationId": "close_session_sessions__session_id__delete",
        "parameters": [
          {
            "name": "session_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Session Id"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SessionResponse"
                }
              }
            }
          },
          "404": {
            "description": "Session not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/escalations/{escalation_id}": {
      "get": {
        "tags": [
          "escalations"
        ],
        "summary": "Get Escalation",
        "description": "Get escalation by ID.\n\nArgs:\n    escalation_id: Escalation UUID\n    db: Database session\n\nReturns:\n    EscalationResponse with escalation details\n\nRaises:\n    HTTPException: If escalation not found",
        "operationId": "get_escalation_escalations__escalation_id__get",
        "parameters": [
          {
            "name": "escalation_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Escalation Id"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EscalationResponse"
                }
              }
            }
          },
          "404": {
            "description": "Escalation not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": [
          "escalations"
        ],
        "summary": "Submit Human Response",
        "description": "Submit human response to an escalation.\n\nArgs:\n    escalation_id: Escalation UUID\n    request: SubmitHumanResponseRequest with action and response\n    db: Database session\n\nReturns:\n    EscalationResponse with updated escalation\n\nRaises:\n    HTTPException: On error",
        "operationId": "submit_human_response_escalations__escalation_id__post",
        "parameters": [
          {
            "name": "escalation_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Escalation Id"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SubmitHumanResponseRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EscalationResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "Escalation not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "409": {
            "description": "Already resolved",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/health": {
      "get": {
        "tags": [
          "health"
        ],
        "summary": "Health",
        "description": "Get Agent Hub health status.\n\nReturns:\n    HealthResponse with status and connected agents",
        "operationId": "health_health_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HealthResponse"
                }
              }
            }
          }
        }
      }
    },
    "/": {
      "get": {
        "summary": "Root",
        "description": "Root endpoint with service info.",
        "operationId": "root__get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "additionalProperties": {
                    "type": "string"
                  },
                  "type": "object",
                  "title": "Response Root  Get"
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "AskExpertRequest": {
        "properties": {
          "question": {
            "type": "string",
            "minLength": 10,
            "title": "Question",
            "description": "Question to ask the expert"
          },
          "context": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Context",
            "description": "Additional context for the question"
          },
          "feature_id": {
            "type": "string",
            "title": "Feature Id",
            "description": "Feature ID for logging"
          },
          "session_id": {
            "anyOf": [
              {
                "type": "string",
                "format": "uuid"
              },
              {
                "type": "null"
              }
            ],
            "title": "Session Id",
            "description": "Session ID for multi-turn conversations"
          }
        },
        "type": "object",
        "required": [
          "question",
          "feature_id"
        ],
        "title": "AskExpertRequest",
        "description": "Request body for /ask/{topic} endpoint."
      },
      "AskExpertResponse": {
        "properties": {
          "answer": {
            "type": "string",
            "title": "Answer"
          },
          "rationale": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Rationale"
          },
          "confidence": {
            "type": "integer",
            "maximum": 100.0,
            "minimum": 0.0,
            "title": "Confidence"
          },
          "uncertainty_reasons": {
            "anyOf": [
              {
                "items": {
                  "type": "string"
                },
                "type": "array"
              },
              {
                "type": "null"
              }
            ],
            "title": "Uncertainty Reasons"
          },
          "status": {
            "type": "string",
            "title": "Status",
            "description": "resolved, pending_human, or needs_reroute"
          },
          "session_id": {
            "type": "string",
            "format": "uuid",
            "title": "Session Id"
          },
          "escalation_id": {
            "anyOf": [
              {
                "type": "string",
                "format": "uuid"
              },
              {
                "type": "null"
              }
            ],
            "title": "Escalation Id"
          }
        },
        "type": "object",
        "required": [
          "answer",
          "confidence",
          "status",
          "session_id"
        ],
        "title": "AskExpertResponse",
        "description": "Response from /ask/{topic} endpoint."
      },
      "CreateSessionRequest": {
        "properties": {
          "agent_id": {
            "type": "string",
            "title": "Agent Id",
            "description": "Agent identifier (e.g., @baron)"
          },
          "feature_id": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Feature Id",
            "description": "Optional feature ID for grouping"
          }
        },
        "type": "object",
        "required": [
          "agent_id"
        ],
        "title": "CreateSessionRequest",
        "description": "Request body for POST /sessions."
      },
      "ErrorDetail": {
        "properties": {
          "code": {
            "type": "string",
            "title": "Code"
          },
          "message": {
            "type": "string",
            "title": "Message"
          },
          "details": {
            "anyOf": [
              {
                "items": {
                  "type": "string"
                },
                "type": "array"
              },
              {
                "type": "null"
              }
            ],
            "title": "Details"
          }
        },
        "type": "object",
        "required": [
          "code",
          "message"
        ],
        "title": "ErrorDetail",
        "description": "Error detail structure."
      },
      "ErrorResponse": {
        "properties": {
          "error": {
            "$ref": "#/components/schemas/ErrorDetail"
          }
        },
        "type": "object",
        "required": [
          "error"
        ],
        "title": "ErrorResponse",
        "description": "Error response structure."
      },
      "EscalationResponse": {
        "properties": {
          "id": {
            "type": "string",
            "title": "Id"
          },
          "status": {
            "type": "string",
            "title": "Status"
          },
          "question": {
            "type": "string",
            "title": "Question"
          },
          "tentative_answer": {
            "type": "string",
            "title": "Tentative Answer"
          },
          "confidence": {
            "type": "integer",
            "title": "Confidence"
          },
          "uncertainty_reasons": {
            "anyOf": [
              {
                "items": {
                  "type": "string"
                },
                "type": "array"
              },
              {
                "type": "null"
              }
            ],
            "title": "Uncertainty Reasons"
          },
          "human_action": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Human Action"
          },
          "human_response": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Human Response"
          },
          "human_responder": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Human Responder"
          },
          "created_at": {
            "type": "string",
            "title": "Created At"
          },
          "resolved_at": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Resolved At"
          }
        },
        "type": "object",
        "required": [
          "id",
          "status",
          "question",
          "tentative_answer",
          "confidence",
          "created_at"
        ],
        "title": "EscalationResponse",
        "description": "Response for escalation endpoints."
      },
      "HTTPValidationError": {
        "properties": {
          "detail": {
            "items": {
              "$ref": "#/components/schemas/ValidationError"
            },
            "type": "array",
            "title": "Detail"
          }
        },
        "type": "object",
        "title": "HTTPValidationError"
      },
      "HealthResponse": {
        "properties": {
          "status": {
            "type": "string",
            "title": "Status",
            "description": "healthy, degraded, or unhealthy"
          },
          "version": {
            "type": "string",
            "title": "Version"
          },
          "uptime_seconds": {
            "anyOf": [
              {
                "type": "integer"
              },
              {
                "type": "null"
              }
            ],
            "title": "Uptime Seconds"
          },
          "connected_agents": {
            "anyOf": [
              {
                "items": {
                  "type": "string"
                },
                "type": "array"
              },
              {
                "type": "null"
              }
            ],
            "title": "Connected Agents"
          }
        },
        "type": "object",
        "required": [
          "status",
          "version"
        ],
        "title": "HealthResponse",
        "description": "Response from /health endpoint."
      },
      "InvokeMetadata": {
        "properties": {
          "duration_ms": {
            "anyOf": [
              {
                "type": "integer"
              },
              {
                "type": "null"
              }
            ],
            "title": "Duration Ms"
          },
          "model_used": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Model Used"
          }
        },
        "type": "object",
        "title": "InvokeMetadata",
        "description": "Metadata about the invocation."
      },
      "InvokeRequest": {
        "properties": {
          "workflow_type": {
            "type": "string",
            "title": "Workflow Type",
            "description": "Type of workflow (e.g., specify, plan, tasks)"
          },
          "context": {
            "additionalProperties": true,
            "type": "object",
            "title": "Context",
            "description": "Context for the agent"
          },
          "parameters": {
            "additionalProperties": true,
            "type": "object",
            "title": "Parameters",
            "description": "Additional parameters"
          },
          "session_id": {
            "anyOf": [
              {
                "type": "string",
                "format": "uuid"
              },
              {
                "type": "null"
              }
            ],
            "title": "Session Id",
            "description": "Optional session ID"
          }
        },
        "type": "object",
        "required": [
          "workflow_type",
          "context"
        ],
        "title": "InvokeRequest",
        "description": "Request body for /invoke/{agent} endpoint."
      },
      "InvokeResponse": {
        "properties": {
          "success": {
            "type": "boolean",
            "title": "Success"
          },
          "result": {
            "anyOf": [
              {
                "$ref": "#/components/schemas/InvokeResult"
              },
              {
                "additionalProperties": true,
                "type": "object"
              }
            ],
            "title": "Result"
          },
          "confidence": {
            "type": "integer",
            "maximum": 100.0,
            "minimum": 0.0,
            "title": "Confidence"
          },
          "metadata": {
            "anyOf": [
              {
                "$ref": "#/components/schemas/InvokeMetadata"
              },
              {
                "additionalProperties": true,
                "type": "object"
              },
              {
                "type": "null"
              }
            ],
            "title": "Metadata"
          },
          "error": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Error"
          },
          "escalation_id": {
            "anyOf": [
              {
                "type": "string",
                "format": "uuid"
              },
              {
                "type": "null"
              }
            ],
            "title": "Escalation Id"
          }
        },
        "type": "object",
        "required": [
          "success",
          "result",
          "confidence"
        ],
        "title": "InvokeResponse",
        "description": "Response from /invoke/{agent} endpoint."
      },
      "InvokeResult": {
        "properties": {
          "output": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Output"
          },
          "files_created": {
            "anyOf": [
              {
                "items": {
                  "type": "string"
                },
                "type": "array"
              },
              {
                "type": "null"
              }
            ],
            "title": "Files Created"
          },
          "files_read": {
            "anyOf": [
              {
                "items": {
                  "type": "string"
                },
                "type": "array"
              },
              {
                "type": "null"
              }
            ],
            "title": "Files Read"
          },
          "uncertainty_reasons": {
            "anyOf": [
              {
                "items": {
                  "type": "string"
                },
                "type": "array"
              },
              {
                "type": "null"
              }
            ],
            "title": "Uncertainty Reasons"
          },
          "data": {
            "anyOf": [
              {
                "additionalProperties": true,
                "type": "object"
              },
              {
                "type": "null"
              }
            ],
            "title": "Data"
          }
        },
        "type": "object",
        "title": "InvokeResult",
        "description": "Result from agent processing."
      },
      "MessageResponse": {
        "properties": {
          "id": {
            "type": "string",
            "title": "Id"
          },
          "role": {
            "type": "string",
            "title": "Role"
          },
          "content": {
            "type": "string",
            "title": "Content"
          },
          "metadata": {
            "anyOf": [
              {
                "additionalProperties": true,
                "type": "object"
              },
              {
                "type": "null"
              }
            ],
            "title": "Metadata"
          },
          "created_at": {
            "type": "string",
            "title": "Created At"
          }
        },
        "type": "object",
        "required": [
          "id",
          "role",
          "content",
          "created_at"
        ],
        "title": "MessageResponse",
        "description": "Message in session response."
      },
      "SessionResponse": {
        "properties": {
          "id": {
            "type": "string",
            "title": "Id"
          },
          "agent_id": {
            "type": "string",
            "title": "Agent Id"
          },
          "feature_id": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Feature Id"
          },
          "status": {
            "type": "string",
            "title": "Status"
          },
          "created_at": {
            "type": "string",
            "title": "Created At"
          },
          "updated_at": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Updated At"
          }
        },
        "type": "object",
        "required": [
          "id",
          "agent_id",
          "status",
          "created_at"
        ],
        "title": "SessionResponse",
        "description": "Response for session endpoints."
      },
      "SessionWithMessagesResponse": {
        "properties": {
          "id": {
            "type": "string",
            "title": "Id"
          },
          "agent_id": {
            "type": "string",
            "title": "Agent Id"
          },
          "feature_id": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Feature Id"
          },
          "status": {
            "type": "string",
            "title": "Status"
          },
          "created_at": {
            "type": "string",
            "title": "Created At"
          },
          "updated_at": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Updated At"
          },
          "messages": {
            "items": {
              "$ref": "#/components/schemas/MessageResponse"
            },
            "type": "array",
            "title": "Messages",
            "default": []
          }
        },
        "type": "object",
        "required": [
          "id",
          "agent_id",
          "status",
          "created_at"
        ],
        "title": "SessionWithMessagesResponse",
        "description": "Session response including messages."
      },
      "SubmitHumanResponseRequest": {
        "properties": {
          "action": {
            "type": "string",
            "title": "Action",
            "description": "Action: confirm, correct, or add_context"
          },
          "response": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Response",
            "description": "Response text (required for 'correct')"
          },
          "responder": {
            "type": "string",
            "title": "Responder",
            "description": "Human responder identifier (e.g., @username)"
          }
        },
        "type": "object",
        "required": [
          "action",
          "responder"
        ],
        "title": "SubmitHumanResponseRequest",
        "description": "Request body for POST /escalations/{id}."
      },
      "ValidationError": {
        "properties": {
          "loc": {
            "items": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "integer"
                }
              ]
            },
            "type": "array",
            "title": "Location"
          },
          "msg": {
            "type": "string",
            "title": "Message"
          },
          "type": {
            "type": "string",
            "title": "Error Type"
          }
        },
        "type": "object",
        "required": [
          "loc",
          "msg",
          "type"
        ],
        "title": "ValidationError"
      }
    }
  }
}
